


@extends('layouts.master')
@section('title', 'Create Property')

@section('style')
<style>
    .preview-image {
        max-width: 200px;
        max-height: 200px;
        margin-top: 10px;
        display: none;
    }
    .required-field::after {
        content: " *";
        color: red;
    }
</style>
@endsection

@section('page')
<div class="row">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">Add New Property</h4>
            <a class="btn btn-success" href="{{ route('propertys.index') }}">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
        </div>

        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Property Information</h5>
            </div>
            <div class="card-body">
                <form action="{{ route('propertys.store') }}" method="post" enctype="multipart/form-data" id="property-form">
                    @csrf

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="title" class="form-label required-field">Title</label>
                                <input type="text" class="form-control @error('title') is-invalid @enderror" 
                                       name="title" id="title" placeholder="Property Title" 
                                       value="{{ old('title') }}" required>
                                @error('title')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>

                            <div class="mb-3">
                                <label for="description" class="form-label required-field">Description</label>
                                <textarea class="form-control @error('description') is-invalid @enderror" 
                                          name="description" id="description" rows="4" 
                                          placeholder="Detailed description of the property" required>{{ old('description') }}</textarea>
                                @error('description')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>


                            <div class="mb-3">
                                <label for="price" class="form-label required-field">Sqft</label>
                                <div class="input-group">
                                    <!-- <span class="input-group-text">$</span> -->
                                    <input type="number" class="form-control @error('sqft') is-invalid @enderror" 
                                           name="sqft" id="sqft" placeholder="700+" 
                                           value="{{ old('sqft') }}" min="700" step="1" required>
                                </div>
                                @error('sqft')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>

                            <div class="mb-3">
                                <label for="price" class="form-label required-field">Bed Room</label>
                                <div class="input-group">
                                    <!-- <span class="input-group-text"></span> -->
                                    <input type="number" class="form-control @error('bed_room') is-invalid @enderror" 
                                           name="bed_room" id="bed_room" placeholder="1+ " 
                                           value="{{ old('bed_room') }}" min="1" step="1" required>
                                </div>
                                @error('bed_room')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>

                            <div class="mb-3">
                                <label for="price" class="form-label required-field">Bath Room</label>
                                <div class="input-group">
                                    <!-- <span class="input-group-text">$</span> -->
                                    <input type="number" class="form-control @error('bath_room') is-invalid @enderror" 
                                           name="bath_room" id="bath_room" placeholder="1+" 
                                           value="{{ old('bath_room') }}" min="1" step="1" required>
                                </div>
                                @error('bath_room')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>






                            <div class="mb-3">
                                <label for="category_id" class="form-label required-field">Category</label>
                                <select class="form-select @error('category_id') is-invalid @enderror" 
                                        name="category_id" id="category_id" required>
                                    <option value="">Select Category</option>
                                    @foreach($categories as $category)
                                        <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>
                                            {{ $category->name }}
                                        </option>
                                    @endforeach
                                </select>
                                @error('category_id')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>

                            <div class="mb-3">
                                <label for="agent_id" class="form-label required-field">Agent</label>
                                <select class="form-select @error('agent_id') is-invalid @enderror" 
                                        name="agent_id" id="agent_id" required>
                                    <option value="">Select Agent</option>
                                    @foreach($agents as $agent)
                                        <option value="{{ $agent->id }}" {{ old('agent_id') == $agent->id ? 'selected' : '' }}>
                                            {{ $agent->name }}
                                        </option>
                                    @endforeach
                                </select>
                                @error('agent_id')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="photo" class="form-label">Property Photo</label>
                                <input type="file" class="form-control @error('photo') is-invalid @enderror" 
                                       name="photo" id="photo" accept="image/*" onchange="previewImage(this)">
                                @error('photo')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                                <img id="image-preview" class="preview-image img-thumbnail" alt="Property Preview">
                            </div>

                            <div class="mb-3">
                                <label for="price" class="form-label required-field">Price ($)</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control @error('price') is-invalid @enderror" 
                                           name="price" id="price" placeholder="0.00" 
                                           value="{{ old('price') }}" min="0" step="0.01" required>
                                </div>
                                @error('price')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>

                            <div class="mb-3">
                                <label for="status" class="form-label required-field">Status</label>
                                <select class="form-select @error('status') is-invalid @enderror" 
                                        name="status" id="status" required>
                                    <option value="">Select Status</option>
                                    <option value="For Sale" {{ old('status') == 'For Sale' ? 'selected' : '' }}>For Sale</option>
                                    <option value="For Rent" {{ old('status') == 'For Rent' ? 'selected' : '' }}>For Rent</option>
                                    <option value="Sold" {{ old('status') == 'Sold' ? 'selected' : '' }}>Sold</option>
                                    <option value="Rented" {{ old('status') == 'Rented' ? 'selected' : '' }}>Rented</option>
                                </select>
                                @error('status')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>

                            <div class="mb-3">
                                <label for="location" class="form-label required-field">Location</label>
                                <input type="text" class="form-control @error('location') is-invalid @enderror" 
                                       name="location" id="location" placeholder="Full address" 
                                       value="{{ old('location') }}" required>
                                @error('location')
                                    <div class="invalid-feedback">{{ $message }}</div>
                                @enderror
                            </div>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <button type="reset" class="btn btn-outline-secondary me-md-2">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Property
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
@endsection

@section('script')
<script>
    function previewImage(input) {
        const preview = document.getElementById('image-preview');
        const file = input.files[0];
        
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            
            reader.readAsDataURL(file);
        } else {
            preview.style.display = 'none';
            preview.src = '';
        }
    }

    // Form validation
    document.getElementById('property-form').addEventListener('submit', function(e) {
        let valid = true;
        
        // Check all required fields
        this.querySelectorAll('[required]').forEach(field => {
            if (!field.value.trim()) {
                valid = false;
                if (!field.classList.contains('is-invalid')) {
                    field.classList.add('is-invalid');
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'invalid-feedback';
                    errorDiv.textContent = 'This field is required';
                    field.parentNode.appendChild(errorDiv);
                }
            }
        });
        
        if (!valid) {
            e.preventDefault();
            // Scroll to the first invalid field
            const firstInvalid = this.querySelector('.is-invalid');
            if (firstInvalid) {
                firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });

    // Remove invalid class when user starts typing
    document.querySelectorAll('input, textarea, select').forEach(element => {
        element.addEventListener('input', function() {
            if (this.classList.contains('is-invalid')) {
                this.classList.remove('is-invalid');
                const errorDiv = this.parentNode.querySelector('.invalid-feedback');
                if (errorDiv) {
                    errorDiv.remove();
                }
            }
        });
    });
</script>
@endsection